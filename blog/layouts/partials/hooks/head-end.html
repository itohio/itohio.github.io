<!-- KaTeX for Math Rendering -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.27/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.27/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.27/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body, {
        delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
            {left: '\\[', right: '\\]', display: true},
            {left: '\\(', right: '\\)', display: false}
        ],
        throwOnError: false
    });"></script>

<!-- Mermaid rendering -->
{{ if .Page.Store.Get "hasMermaid" }}
  <script src="https://cdn.jsdelivr.net/npm/mermaid@11.4.0/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ startOnLoad: true });
  </script>
{{ end }}

<!-- waveforms rendering -->
{{ if .Page.Store.Get "hasWave" }}
<script src="https://cdn.jsdelivr.net/npm/wavedrom@3.3.0/skins/default.js"></script>
<script src="https://cdn.jsdelivr.net/npm/wavedrom@3.3.0/wavedrom.min.js"></script>
{{ end }}

<!-- chart.js rendering -->
{{ if .Page.Store.Get "hasChart" }}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js"></script>
{{ end }}

<!-- graphviz rendering -->
{{ if .Page.Store.Get "hasGraphViz" }}
<script src="https://cdn.jsdelivr.net/npm/viz.js@2.1.2/viz.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/viz.js@2.1.2/full.render.js"></script>
{{ end }}

<!-- P5JS rendering -->
{{ if .Page.Store.Get "P5JSInstances" }}
<script src="https://cdn.jsdelivr.net/npm/p5@1.10.0/lib/p5.min.js"></script>
{{ end }}

<!-- Initialize diagram renderers after page load -->
<script>
  window.addEventListener("load", function() {
    // WaveDrom
    if (typeof WaveDrom !== 'undefined') {
      WaveDrom.ProcessAll();
    }
    
    // Chart.js
    if (typeof Chart !== 'undefined') {
      const chartPrefix = "codeblock-chart";
      var chartIndex = 0;
      Array.prototype.forEach.call(document.querySelectorAll("[class^=" + chartPrefix + "]"), function (x) {
        x.style.display = 'none';
        var canvas = document.createElement('canvas');
        canvas.height = 200;
        canvas.style.height = 200;
        canvas.id = 'myChart' + chartIndex;
        var source = JSON.parse(x.innerText);
        x.parentNode.insertBefore(canvas, x);
        var ctx = canvas.getContext('2d');
        var myChart = new Chart(ctx, source);
        chartIndex += 1;
      });
    }
    
    // Graphviz
    if (typeof Viz !== 'undefined') {
      var vizPrefix = "codeblock-viz-dot";
      Array.prototype.forEach.call(document.querySelectorAll("[class^=" + vizPrefix + "]"), function (x) {
        x.style.display = 'none';
        var viz = new Viz();
        viz.renderSVGElement(x.innerText)
          .then(function (element) {
            element.style.width = "100%";
            x.parentNode.insertBefore(element, x);
          });
      });
    }
  });
</script>

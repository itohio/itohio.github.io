{{- define "main" }}
{{- $s := .Site.Params }}
{{- $p := .Params }}
<div class="grid-inverse wrap content">
  <div>
    {{- partial "breadcrumbs.html" . }}
    {{- $sections := where .Pages "Kind" "section" }}
    {{- $pages := where .Pages "Kind" "page" }}
    
    <article class="post_content">
      <h1 class="post_title">{{ .Title | markdownify }}</h1>
      {{- partial "post-meta" . }}
      <div class="post_body">
        {{- .Content }}
        
        {{- if $sections }}
        {{- /* Main snippets page - show categories */ -}}
        <h2 class="post_related">Categories</h2>
        <ul>
          {{- range $sections.ByTitle }}
          <li>
            <a href="{{ .RelPermalink }}" class="nav-link" title="{{ .Title }}">{{ .Title }}</a>
            {{- $desc := "" }}
            {{- with .Params.description }}
              {{- $desc = . }}
            {{- else }}
              {{- $desc = .Summary | plainify | truncate 80 }}
            {{- end }}
            {{- if $desc }}<br><small>{{ $desc }}</small>{{ end }}
          </li>
          {{- end }}
        </ul>
        {{- else if $pages }}
        {{- /* Category page - show all snippets in that category */ -}}
        {{- partial "related-snippets.html" (dict "Page" . "heading" "Snippets" "excludeCurrent" false) }}
        {{- end }}
      </div>
    </article>
  </div>
  {{- if ( ne $p.sidebar false ) }}
    {{- partial "sidebar" . }}
  {{ end }}
</div>
{{- end }}

---
title: "MySQL Essentials"
date: 2024-12-12
draft: false
category: "database"
tags: ["database-knowhow", "mysql", "sql"]
---


MySQL commands, optimization, and Docker setup.

---

## Docker Setup

### Docker Run

```bash
# Run MySQL
docker run -d \
  --name mysql \
  -e MYSQL_ROOT_PASSWORD=rootpassword \
  -e MYSQL_DATABASE=mydb \
  -e MYSQL_USER=myuser \
  -e MYSQL_PASSWORD=password \
  -v mysql-data:/var/lib/mysql \
  -p 3306:3306 \
  mysql:8

# Connect
docker exec -it mysql mysql -u myuser -p
```

### Docker Compose

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8
    container_name: mysql
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: mydb
      MYSQL_USER: myuser
      MYSQL_PASSWORD: password
    volumes:
      - mysql-data:/var/lib/mysql
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "3306:3306"
    command: --default-authentication-plugin=mysql_native_password
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  phpmyadmin:
    image: phpmyadmin:latest
    container_name: phpmyadmin
    environment:
      PMA_HOST: mysql
      PMA_USER: myuser
      PMA_PASSWORD: password
    ports:
      - "8080:80"
    depends_on:
      - mysql
    restart: unless-stopped

volumes:
  mysql-data:
```

---

## Basic Commands

```bash
# Connect
mysql -h localhost -u myuser -p

# Show databases
SHOW DATABASES;

# Use database
USE mydb;

# Show tables
SHOW TABLES;

# Describe table
DESCRIBE users;
SHOW CREATE TABLE users;

# Show indexes
SHOW INDEX FROM users;

# Show processlist
SHOW PROCESSLIST;

# Show variables
SHOW VARIABLES LIKE '%timeout%';

# Export database
mysqldump -u myuser -p mydb > backup.sql

# Import database
mysql -u myuser -p mydb < backup.sql
```

---

## MySQL-Specific Features

### AUTO_INCREMENT

```sql
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL
);

-- Get last inserted ID
SELECT LAST_INSERT_ID();

-- Reset AUTO_INCREMENT
ALTER TABLE users AUTO_INCREMENT = 1;
```

### ENUM Type

```sql
CREATE TABLE orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    status ENUM('pending', 'processing', 'completed', 'cancelled') DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Full-Text Search

```sql
-- Create table with FULLTEXT index
CREATE TABLE articles (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(200),
    content TEXT,
    FULLTEXT INDEX idx_search (title, content)
) ENGINE=InnoDB;

-- Search
SELECT *, MATCH(title, content) AGAINST('mysql database' IN NATURAL LANGUAGE MODE) AS relevance
FROM articles
WHERE MATCH(title, content) AGAINST('mysql database' IN NATURAL LANGUAGE MODE)
ORDER BY relevance DESC;

-- Boolean mode
SELECT * FROM articles
WHERE MATCH(title, content) AGAINST('+mysql -oracle' IN BOOLEAN MODE);
```

### Stored Procedures

```sql
DELIMITER //

CREATE PROCEDURE GetUserOrders(IN userId INT)
BEGIN
    SELECT * FROM orders WHERE user_id = userId;
END //

DELIMITER ;

-- Call procedure
CALL GetUserOrders(1);

-- Procedure with OUT parameter
DELIMITER //

CREATE PROCEDURE GetOrderCount(IN userId INT, OUT orderCount INT)
BEGIN
    SELECT COUNT(*) INTO orderCount FROM orders WHERE user_id = userId;
END //

DELIMITER ;

-- Call
CALL GetOrderCount(1, @count);
SELECT @count;
```

### Triggers

```sql
DELIMITER //

CREATE TRIGGER before_user_update
BEFORE UPDATE ON users
FOR EACH ROW
BEGIN
    SET NEW.updated_at = CURRENT_TIMESTAMP;
END //

DELIMITER ;
```

---

## Optimization

```sql
-- Analyze table
ANALYZE TABLE users;

-- Optimize table
OPTIMIZE TABLE users;

-- Check table
CHECK TABLE users;

-- Repair table
REPAIR TABLE users;

-- Show table status
SHOW TABLE STATUS LIKE 'users';

-- Explain query
EXPLAIN SELECT * FROM users WHERE email = 'test@example.com';
EXPLAIN FORMAT=JSON SELECT * FROM users WHERE email = 'test@example.com';
```

---

## Indexes

```sql
-- Create index
CREATE INDEX idx_email ON users(email);

-- Composite index
CREATE INDEX idx_name_email ON users(last_name, first_name, email);

-- Unique index
CREATE UNIQUE INDEX idx_username ON users(username);

-- Full-text index
CREATE FULLTEXT INDEX idx_content ON articles(content);

-- Drop index
DROP INDEX idx_email ON users;

-- Show indexes
SHOW INDEX FROM users;
```

---
---
title: "SQLite Essentials"
date: 2024-12-12
draft: false
category: "database"
tags: ["database-knowhow", "sqlite", "sql", "embedded"]
---


SQLite commands for embedded database applications.

---

## Basic Commands

```bash
# Create/open database
sqlite3 mydb.db

# Open in-memory database
sqlite3 :memory:

# Execute SQL file
sqlite3 mydb.db < schema.sql

# Dump database
sqlite3 mydb.db .dump > backup.sql

# Export to CSV
sqlite3 -header -csv mydb.db "SELECT * FROM users;" > users.csv
```

### In SQLite Shell

```sql
-- Show tables
.tables

-- Show schema
.schema
.schema users

-- Show indexes
.indexes
.indexes users

-- Change output mode
.mode column
.mode csv
.mode json
.mode markdown

-- Show headers
.headers on

-- Import CSV
.mode csv
.import users.csv users

-- Export to CSV
.headers on
.mode csv
.output users.csv
SELECT * FROM users;
.output stdout

-- Timing
.timer on

-- Help
.help

-- Quit
.quit
```

---

## Docker Setup

```yaml
version: '3.8'

services:
  app:
    image: python:3.11-slim
    container_name: sqlite-app
    volumes:
      - ./app:/app
      - sqlite-data:/data
    working_dir: /app
    command: python app.py
    environment:
      DATABASE_PATH: /data/mydb.db

volumes:
  sqlite-data:
```

---

## Python Integration

```python
import sqlite3
from contextlib import contextmanager

@contextmanager
def get_db_connection(db_path='mydb.db'):
    """Context manager for database connection"""
    conn = sqlite3.connect(db_path)
    conn.row_factory = sqlite3.Row  # Access columns by name
    try:
        yield conn
        conn.commit()
    except Exception:
        conn.rollback()
        raise
    finally:
        conn.close()

# Usage
with get_db_connection() as conn:
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM users WHERE id = ?", (1,))
    user = cursor.fetchone()
    print(dict(user))

# Create table
with get_db_connection() as conn:
    conn.execute("""
        CREATE TABLE IF NOT EXISTS users (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            username TEXT UNIQUE NOT NULL,
            email TEXT UNIQUE NOT NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    """)

# Insert
with get_db_connection() as conn:
    conn.execute(
        "INSERT INTO users (username, email) VALUES (?, ?)",
        ('john', 'john@example.com')
    )

# Query
with get_db_connection() as conn:
    cursor = conn.execute("SELECT * FROM users")
    for row in cursor:
        print(dict(row))

# Transaction
with get_db_connection() as conn:
    conn.execute("BEGIN")
    try:
        conn.execute("UPDATE accounts SET balance = balance - 100 WHERE id = 1")
        conn.execute("UPDATE accounts SET balance = balance + 100 WHERE id = 2")
        conn.execute("COMMIT")
    except:
        conn.execute("ROLLBACK")
        raise
```

---

## SQLite-Specific Features

### AUTOINCREMENT

```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT NOT NULL
);
```

### JSON Support (SQLite 3.38+)

```sql
-- Create table with JSON
CREATE TABLE products (
    id INTEGER PRIMARY KEY,
    name TEXT,
    attributes JSON
);

-- Insert JSON
INSERT INTO products (name, attributes) VALUES
    ('Laptop', '{"brand": "Dell", "ram": "16GB"}');

-- Query JSON
SELECT json_extract(attributes, '$.brand') FROM products;
SELECT * FROM products WHERE json_extract(attributes, '$.ram') = '16GB';

-- JSON functions
SELECT json_type(attributes) FROM products;
SELECT json_array_length(json_extract(attributes, '$.tags')) FROM products;
```

### Full-Text Search (FTS5)

```sql
-- Create FTS table
CREATE VIRTUAL TABLE articles_fts USING fts5(title, content);

-- Insert
INSERT INTO articles_fts (title, content) VALUES
    ('SQLite Tutorial', 'Learn SQLite database...');

-- Search
SELECT * FROM articles_fts WHERE articles_fts MATCH 'sqlite database';

-- Rank results
SELECT *, rank FROM articles_fts 
WHERE articles_fts MATCH 'sqlite'
ORDER BY rank;
```

---

## Performance

```sql
-- Analyze
ANALYZE;

-- Vacuum (reclaim space)
VACUUM;

-- Enable WAL mode (better concurrency)
PRAGMA journal_mode=WAL;

-- Increase cache size
PRAGMA cache_size=10000;

-- Synchronous mode
PRAGMA synchronous=NORMAL;

-- Show query plan
EXPLAIN QUERY PLAN SELECT * FROM users WHERE email = 'test@example.com';
```

---